{"code":"import { __awaiter } from \"tslib\";\r\nexport class FmServer {\r\n    constructor() {\r\n        this.handlers = {};\r\n    }\r\n    get_handler_list(need_handler) {\r\n        var _a;\r\n        const list = [];\r\n        for (const path of Object.keys(this.handlers)) {\r\n            for (const method of Object.keys(this.handlers[path]).sort()) {\r\n                if (need_handler) {\r\n                    list.push({ method: method, path, handler: (_a = this.handlers[path]) === null || _a === void 0 ? void 0 : _a[method] });\r\n                }\r\n                else {\r\n                    list.push({ method: method, path });\r\n                }\r\n            }\r\n        }\r\n        return list;\r\n    }\r\n    on(method, path, handler) {\r\n        if (Array.isArray(path)) {\r\n            for (const p of path) {\r\n                this.set_handler(method, p, handler);\r\n            }\r\n        }\r\n        else {\r\n            this.set_handler(method, path, handler);\r\n        }\r\n    }\r\n    handleRequest(context, next) {\r\n        var _a, _b;\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const req = context.request;\r\n            const params = req.method === 'GET' || req.method === 'DELETE' ? req.query : req.body;\r\n            const res = yield ((_b = (_a = this.handlers[req.path]) === null || _a === void 0 ? void 0 : _a[req.method]) === null || _b === void 0 ? void 0 : _b.call(_a, params, context));\r\n            if (res !== undefined) {\r\n                context.response.body = res;\r\n            }\r\n            return next();\r\n        });\r\n    }\r\n    set_handler(method, path, handler) {\r\n        if (!this.handlers[path]) {\r\n            this.handlers[path] = {};\r\n        }\r\n        this.handlers[path][method] = handler;\r\n    }\r\n}\r\n//# sourceMappingURL=fm-server.js.map","references":["/Users/caojiahang/代码/tora/node_modules/@types/koa/index.d.ts","/Users/caojiahang/代码/tora/src/server/types.ts"],"map":"{\"version\":3,\"file\":\"fm-server.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/server/fm-server.ts\"],\"names\":[],\"mappings\":\";AAGA,MAAM,OAAO,QAAQ;IAArB;QAEY,aAAQ,GAOZ,EAAE,CAAA;IA8CV,CAAC;IA5CG,gBAAgB,CAAC,YAAsB;;QACnC,MAAM,IAAI,GAIJ,EAAE,CAAA;QACR,KAAK,MAAM,IAAI,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;YAC3C,KAAK,MAAM,MAAM,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,EAAE,EAAE;gBAC1D,IAAI,YAAY,EAAE;oBACd,IAAI,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,MAAmB,EAAE,IAAI,EAAE,OAAO,QAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,0CAAG,MAAmB,CAAC,EAAE,CAAC,CAAA;iBACxG;qBAAM;oBACH,IAAI,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,MAAmB,EAAE,IAAI,EAAE,CAAC,CAAA;iBACnD;aACJ;SACJ;QACD,OAAO,IAAI,CAAA;IACf,CAAC;IAED,EAAE,CAAiC,MAAiB,EAAE,IAAa,EAAE,OAA8D;QAC/H,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;YACrB,KAAK,MAAM,CAAC,IAAI,IAAI,EAAE;gBAClB,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE,OAAO,CAAC,CAAA;aACvC;SACJ;aAAM;YACH,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,IAAI,EAAE,OAAO,CAAC,CAAA;SAC1C;IACL,CAAC;IAEK,aAAa,CAAC,OAAoB,EAAE,IAAc;;;YACpD,MAAM,GAAG,GAA6B,OAAO,CAAC,OAAO,CAAA;YACrD,MAAM,MAAM,GAAG,GAAG,CAAC,MAAM,KAAK,KAAK,IAAI,GAAG,CAAC,MAAM,KAAK,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAA;YACrF,MAAM,GAAG,GAAG,mBAAM,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,0CAAG,GAAG,CAAC,MAAmB,oDAAI,MAAM,EAAE,OAAO,EAAC,CAAA;YACvF,IAAI,GAAG,KAAK,SAAS,EAAE;gBACnB,OAAO,CAAC,QAAQ,CAAC,IAAI,GAAG,GAAG,CAAA;aAC9B;YACD,OAAO,IAAI,EAAE,CAAA;;KAChB;IAEO,WAAW,CAAC,MAAiB,EAAE,IAAY,EAAE,OAAoB;QACrE,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE;YACtB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,EAAE,CAAA;SAC3B;QACD,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,GAAG,OAAO,CAAA;IACzC,CAAC;CACJ\"}"}
