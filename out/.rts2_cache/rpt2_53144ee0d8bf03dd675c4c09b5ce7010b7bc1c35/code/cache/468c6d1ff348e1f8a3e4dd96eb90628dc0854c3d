{"code":"import 'reflect-metadata';\r\nimport { def2Provider } from './di';\r\nimport { FM_DI_TOKEN, TokenUtils } from './token';\r\nexport function FmModule(options) {\r\n    return function (target) {\r\n        TokenUtils.setClassType(target, 'fm_module');\r\n        Reflect.defineMetadata(FM_DI_TOKEN.module_provider_collector, makeProviderCollector(target, options), target);\r\n        if (options === null || options === void 0 ? void 0 : options.router_gate) {\r\n            Reflect.defineMetadata(FM_DI_TOKEN.module_router_gate, options.router_gate, target);\r\n        }\r\n    };\r\n}\r\nexport function find_usage(tree, indent = 0) {\r\n    var _a, _b;\r\n    return ((_a = tree === null || tree === void 0 ? void 0 : tree.providers) === null || _a === void 0 ? void 0 : _a.find(p => p.used)) || ((_b = tree === null || tree === void 0 ? void 0 : tree.children) === null || _b === void 0 ? void 0 : _b.find(t => find_usage(t, indent + 1)));\r\n}\r\nfunction makeProviderCollector(target, options) {\r\n    return function (injector) {\r\n        var _a, _b, _c, _d;\r\n        const children = (_a = options === null || options === void 0 ? void 0 : options.imports) === null || _a === void 0 ? void 0 : _a.map(md => { var _a; return (_a = Reflect.getMetadata(FM_DI_TOKEN.module_provider_collector, md)) === null || _a === void 0 ? void 0 : _a(injector); });\r\n        const providers = [\r\n            ...(_d = (_c = def2Provider([...(_b = options === null || options === void 0 ? void 0 : options.providers) !== null && _b !== void 0 ? _b : []], injector)) === null || _c === void 0 ? void 0 : _c.map(item => {\r\n                injector.set_provider(item[0], item[1]);\r\n                return item[1];\r\n            })) !== null && _d !== void 0 ? _d : []\r\n        ];\r\n        return { name: target.name, providers, children };\r\n    };\r\n}\r\n//# sourceMappingURL=fm-module.js.map","references":["/Users/caojiahang/代码/tora/node_modules/reflect-metadata/index.d.ts","/Users/caojiahang/代码/tora/src/di/index.ts","/Users/caojiahang/代码/tora/src/token.ts","/Users/caojiahang/代码/tora/src/type.ts"],"map":"{\"version\":3,\"file\":\"fm-module.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../src/fm-module.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,kBAAkB,CAAA;AACzB,OAAO,EAAE,YAAY,EAAsB,MAAM,MAAM,CAAA;AACvD,OAAO,EAAE,WAAW,EAAE,UAAU,EAAE,MAAM,SAAS,CAAA;AAejD,MAAM,UAAU,QAAQ,CAAC,OAAqB;IAC1C,OAAO,UAAS,MAAW;QACvB,UAAU,CAAC,YAAY,CAAC,MAAM,EAAE,WAAW,CAAC,CAAA;QAC5C,OAAO,CAAC,cAAc,CAAC,WAAW,CAAC,yBAAyB,EAAE,qBAAqB,CAAC,MAAM,EAAE,OAAO,CAAC,EAAE,MAAM,CAAC,CAAA;QAC7G,IAAI,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,WAAW,EAAE;YACtB,OAAO,CAAC,cAAc,CAAC,WAAW,CAAC,kBAAkB,EAAE,OAAO,CAAC,WAAW,EAAE,MAAM,CAAC,CAAA;SACtF;IACL,CAAC,CAAA;AACL,CAAC;AAED,MAAM,UAAU,UAAU,CAAC,IAAsB,EAAE,SAAiB,CAAC;;IACjE,OAAO,OAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,SAAS,0CAAE,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,aACjC,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,QAAQ,0CAAE,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC,EAAE,MAAM,GAAG,CAAC,CAAC,EAAC,CAAA;AAC/D,CAAC;AAED,SAAS,qBAAqB,CAAC,MAAW,EAAE,OAAqB;IAC7D,OAAO,UAAS,QAAkB;;QAC9B,MAAM,QAAQ,SAAG,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,OAAO,0CAAE,GAAG,CAAC,EAAE,CAAC,EAAE,wBAAC,OAAO,CAAC,WAAW,CAAC,WAAW,CAAC,yBAAyB,EAAE,EAAE,CAAC,0CAAG,QAAQ,IAAC,CAAC,CAAA;QACxH,MAAM,SAAS,GAAoB;YAC/B,eAAG,YAAY,CAAC,CAAC,SAAG,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,SAAS,mCAAI,EAAE,CAAgC,EAAE,QAAQ,CAAC,0CACjF,GAAG,CAAC,IAAI,CAAC,EAAE;gBACT,QAAQ,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAA;gBACvC,OAAO,IAAI,CAAC,CAAC,CAAC,CAAA;YAClB,CAAC,oCACF,EAAE;SAAC,CAAA;QAEV,OAAO,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,SAAS,EAAE,QAAQ,EAAE,CAAA;IACrD,CAAC,CAAA;AACL,CAAC\"}"}
